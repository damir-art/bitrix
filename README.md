# 1С-Битрикс
Руководство по темизации 1С-Битрикс  
Блог (лучший): https://hmarketing.ru/blog/bitrix/  
Блог новостей Битрикс.

## Установка 1С-Битрикс
Восстановление Битрикс происходит через создание резервной копии и файла restore.php, который нужно установить в корень домена.

С 2023го года нужно устанавливать Битрикс на версию PHP 8 или выше.

- OpenServer:
  - Apache_2.4-PHP_8.0-8.1
  - PHP_8.0
  - MySQL-5.6
- Если при установки возникнет ошибка то нужно в файле: `/bitrix/modules/main/lib/security/random.php`
  - см. конец страницы: https://dev.1c-bitrix.ru/support/forum/forum6/topic153708/
  - в методе `getStringByCharsets($length, $charsetList){ }` строка 114

В начале метода написать (и удалить после установки Битрикс):

    // Временно возвращаем "свою" рандомную строку
    $characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
    $randstring = '';
    for ($i = 0; $i < 10; $i++) {
      $randstring = $characters[rand(0, strlen($characters))];
    }
    return $randstring; // Конец

- Скрипт проверки сервера: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=135&LESSON_ID=5412
- Создаём БД в phpMyAdmin (root без пароля) utf8_general_ci (можно не создавать)
- Скрипт установки Битрикс располагается по адресу: https://www.1c-bitrix.ru/download/cms.php
  - Скачайте файл bitrixsetup.php и запустите его введя в адресной строке браузера
  - Коогда файл загрузит дистрибутив и появится окно "Начало установки"
  - Перейдите по адресу `/bitrix/modules/main/lib/security/random.php`
  - На строке 114, в начале метода `getStringByCharsets($length, $charsetList){ }` временно разместите код (см выше), после установки Битрикс удалите этот код
- 1C-Битрикс: Управление сайтом -> Бизнес
- Снимаем галочку "Регистрация продукта"
- База данных:
  - имя пользователя root
  - тип БД по-умолчанию или innoDB
- Авторизация: http://site.loc/bitrix/admin/index.php

## После установки
- Админ: Настройки > Инструменты > Проверка системы
- В .htaccess: `php_value max_input_vars 11000`
- Режим работы MySQL: `Ошибка! innodb_strict_mode=ON, требуется OF` (перед исправлением нужно решить проблему со стилями)
- `Админ > Настройки > Настройки продукта > Настройки модулей > Главный модуль`:
  - Название сайта: Имя компании
  - Оптимизация CSS: все галочки убраны
- `Админ > Настройки > Настройки продукта > Настройки модулей > Информационные блоки`:
  - Совместный просмотр разделов и элементов

## Проблема со стилями внутри админки
Например если не прогрузились стили в элементах новостей и т.п.
- OpenServer > Дополнительно > Конфигурация > Apache_2.4-PHP_7.2-7.4 (откроется два файла)
- В файле Apache_2.4-PHP_7.2-7.4**_server.conf** ищем `well-known` заменяем на `well-known|default`
- Перезагружаем OpenServer

### Для Apache 2.4 PHP 7.2-7.4 Nginx_1.19
- Если не прогрузились стили админки Битрикс: https://ospanel.io/forum/viewtopic.php?f=1&t=1818&start=10
- Нужно поставить модуль `Apache 2.4 PHP 7.2-7.4 Nginx_1.19`
- Открыть файл `Apache_2.4-PHP_7.2-7.4+Nginx_1.19_vhostn.conf`
- По адресу: `Флажок > Дополнительно > Конфигурация`

Закомментировать следующий код (в поздних версиях код начинается с `location`) и обязательно перезапустить сервер:

    # Disable access to hidden files/folders
    # if ($uri ~* /\.(?!well-known)) {
    #     return 404;
    # }

PS: попробовать сначала `well-known` заменить на `well-known|default`.

## Вывод ошибок
Включаем отображение ошибок.  
- Переходим в bitrix/.settings.php
- Включаем `true` в разделе
- exception_handling > value > debug

## Разное
- Часть данных Битрикс хранит в файлах, а остальное в БД

## Безопасность
- запретить регистрацию пользователей "Настройка главного модуля",

## Настройки
Настройка продукта:
- Сайты > Список сайтов - можно создать несколько сайтов.

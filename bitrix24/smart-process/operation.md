# Операции
https://bx24devbook.website.yandexcloud.net/Modul_CRM/Smart_processy/Operacii.html  

Операция - действие или их совокупность для достижения какой-либо цели.

Рассуждая об элементах смарт-процессов в CRM можно запросто запутаться в понятиях и их взаимосвязях. Поначалу неопытные разработчики принимают запись в базу каких-либо значений за совершение действий, однако это вовсе не так. Если вы записали в какую-то таблицу какие-то значения, то это совершенно не значит что те же действия будут выполнены и в стандартных компонентах. Нет-нет, определенно запись в базу данных там тоже будет, но это будет являться лишь вершиной айсберга.

Представим себе элемент смарт-процесса, который мы хотим добавить. Добавление это действие которое мы хотим совершить и запись в базу лишь часть действительно большого процесса - добавления элемента. Здесь мы можем попасть в логическую ловушку и подумать что процесс добавление элемента это и есть фактическое добавление записи в базу данных однако не стоит забыть что в нем так же участвуют обработчики событий, проверки прав, нормализация данных, поисковая индексация и другие важные этапы, в том числе запуск бизнес-процессов запускаемых при добавлении элемента.

Термин "Операция" наиболее емко описывает необходимый набор действий для достижений конкретной цели. Например "Операция добавления элемента" описывается набор действий который нужно выполнить над элементом для его полного и корректного сохранения.

## Порядок действий в операции
В общем случае, процесс выполняется следующим образом:
- Проверка тарифных ограничений,
- Проверка прав доступа к элементу,
- Проверка запущенных БП (актуально для удаления),
- Обработка доп. логик полей перед операцией,
- Проверка заполненных полей (на предмет обязательности),
- Если элемент изменен, запуск Действий до сохранения,
- Если элемент не изменен - завершение операции,
- Обработка доп. логик полей после операции,
- Обновление прав,
- Обновление поискового индекса,
- Сохранение записи в историю и timeline,
- Запуск Действий после сохранения,
- Если применимы стадии - отправка push сообщения,
- Запуск бизнес-процессов,
- Запуск автоматизации.

Порядок выполнения действий строго определен, однако в зависимости от конкретной операции, некоторые действия могут быть пропущены (вернуть базовый \Bitrix\Main\Result). 

На текущий момент существует несколько зарегистрированных и поддерживаемых операций:

- Добавление `\Bitrix\Crm\Service\Operation\Add`
- Обновление `\Bitrix\Crm\Service\Operation\Update`
- Удаление `\Bitrix\Crm\Service\Operation\Delete`
- Копирование `\Bitrix\Crm\Service\Operation\Copy`
- Конвертация `\Bitrix\Crm\Service\Operation\Conversion`
